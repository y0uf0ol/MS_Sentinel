// Detect sus long DNS querys
let Whitelist=dynamic(["microsoft"]); //Add your Whitelist
DeviceNetworkEvents
| extend ReverseURL=reverse(RemoteUrl)
//split URL on every Dot
| extend substring=split(ReverseURL, '.')
| extend revDomain=strcat(substring[0], ".", substring[1])
// Combine every substring 
| extend Combine= strcat(substring[2], ".", substring[3], ".", substring[4], ".", substring[5], ".", substring[6], substring[7], ".", substring[8])
// reverse everythin back to normal
| extend revCombine=reverse(Combine)
| extend Domain=reverse(revDomain)
| where isnotempty(ReverseURL)
//check for long string
| where string_size(revCombine) > 50
// Whitelist filter
| where not(Domain has_any (Whitelist))
| project
    TimeGenerated,
    DeviceName,
    RemoteIP,
    InitiatingProcessCommandLine,
    RemoteUrl,
    RemotePort,
    revCombine,
    Domain
